<!doctype html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

<script>

	var app = angular.module("ItemCalculator", []);
	app.controller("MainController", function($scope,$http)
	{

		$scope.calculator = {
			"messages":
			{
				"rank_team":"Great Job. Wait to receive a password to see expert rankings.",
				"rank_individual":"Now rank as a team. Notice what has changed or stayed the same.",
              "password_revealed":"Now check your score",
				"default":"Please rank individually."
			},
			"expert_rank_password":"password",
			"reveal_expert_rank":false,
			"items":
			{
				"sleeping_bag":
				{
					"name":"sleeping_bag",
					"label":"Sleeping Bag Per Person",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":4
				},
				"snow_shoes":
				{
					"name":"snow_shoes",
					"label":"Snow Shoes",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":7
				},
				"maple_syrup":
				{
					"name":"maple_syrup",
					"label":"Maple Syrup",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":5
				},
				"water_purification_tablets":
				{
					"name":"water_purification_tablets",
					"label":"Water Purification Tablets",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":15
				},
				"hand_ax":
				{
					"name":"hand_ax",
					"label":"Hand Ax",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":2
				},
				"nylon_rope":
				{
					"name":"nylon_rope",
					"label":"Nylon Rope",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":6
				},
				"rum":
				{
					"name":"rum",
					"label":"Rum",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":11
				},
				"inner_tube":
				{
					"name":"inner_tube",
					"label":"Inner Tube",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":8
				},
				"alarm_clock":
				{
					"name":"alarm_clock",
					"label":"Alarm Clock",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":12
				},
				"heavy_duty_canvas":
				{
					"name":"heavy_duty_canvas",
					"label":"Heavy Duty Canvas",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":3
				},
				"matches":
				{
					"name":"matches",
					"label":"Matches",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":1
				},
				"compass":
				{
					"name":"compass",
					"label":"Compass",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":13
				},
				"flashlight":
				{
					"name":"flashlight",
					"label":"Flashlight",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":10
				},
				"book":
				{
					"name":"book",
					"label":"Book",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":14
				},
				"shaving_kit":
				{
					"name":"shaving_kit",
					"label":"Shaving Kit",
					"rank_individual":0,
					"rank_team":0,
					"rank_expert":9
				}
			}
		};
      
      
		$scope.state = "default";

		$scope.checkIfColumnFilled = function(column)
		{
			var filled = 0;
			var cnt = 0;
			
			for(var i in $scope.calculator.items)
			{
				cnt++;
				var item = $scope.calculator.items[i];
				if(item[column]>0)
				{
					filled++;
				}
			}
			
			if(column=="rank_individual")
			{
				if(filled==cnt)
				{
					$scope.state = "step1_completed";
					return true;
				}
				else
				{
					$scope.state = "default";
					//$scope.last_message = "";
					//$scope.calculator.reveal_expert_rank = false;
				}
				//$scope.status = $scope.calculator.messages["rank_individual"];
			}
			else if(column=="rank_team")
			{
				if(filled==cnt)
				{
					$scope.state = "step2_completed";
					return true;
				}
				else
				{
					//$scope.last_message = "";
					//$scope.calculator.reveal_expert_rank = false;
				}
				//$scope.status = $scope.calculator.messages["rank_team"];
			}
			return false;
		}

		$scope.getRanks = function(x,node)
		{
			if(x==undefined || x==null)
			{
				return new Array();
			}
			var arr = new Array();
			//arr.push("None");
			var cnt = 0;

			var selectedRanks = new Array();
			for(var i in $scope.calculator.items)
			{
				//cnt++;
				selectedRanks.push($scope.calculator.items[i][x]);
				//arr.push(cnt);
			}
			console.log(selectedRanks);
			for(var i in $scope.calculator.items)
			{
				cnt++;
				if(selectedRanks.indexOf(cnt)==-1 || node[x]==cnt)
				{
					arr.push(cnt);
				}
			}
			return arr;
		}

		$scope.my_total = 0;
		$scope.team_total = 0;
		$scope.abs = function(x,n)
		{
			var y = Math.abs(x);
			if(n=="my_total")
			{
				$scope.my_total += y;
			}
			else if(n=="team_total")
			{
				$scope.team_total += y;
			}
			return y;
		};

		$scope.getItemsCount = function()
		{
			
			var cnt = 0;

			for(var i in $scope.calculator.items)
			{
				cnt++;
			}
			return cnt;
		}
        $scope.last_message = "";

		$scope.reveal = function()
		{
			var p = window.prompt("Enter the Password:");
			if(p==$scope.calculator.expert_rank_password)
			{
				$scope.calculator.reveal_expert_rank = true;
				$scope.last_message = $scope.calculator.messages["password_revealed"];
				$scope.state = "step3_completed";
			}
		};

		$scope.getTotals = function(n)
		{	
			var tot = 0;
			for(var i in $scope.calculator.items)
			{
				var item = $scope.calculator.items[i];
				if(n=="team_total")
				{
					if(item.rank_team>0)
					{
						var diff = item.rank_expert - item.rank_team;
						diff = Math.abs(diff);
						$scope.team_total += diff;
						tot += diff;
					}
				}
				else if(n=="my_total")
				{
					if(item.rank_individual>0)
					{
						var diff = item.rank_expert - item.rank_individual;
						diff = Math.abs(diff);
						$scope.my_total += diff;
						tot += diff;
					}
				}
			}
			return tot;
		}

		$scope.status = "Please rank individually.";

		
	});

	</html>
